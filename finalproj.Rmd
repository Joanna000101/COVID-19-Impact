```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
lib--- 
title: "Impact of COVID-19"
author: "Runnan Jiang, Wanling Bai, Yancheng Zhang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---

# Introduction

Recent years have witnessed the significant impact of COVID-19. Discovered in December 2019, COVID-19 quickly spread throughout the world. In March 2020, The World Health Organization declared the COVID-19 outbreak as a pandemic. It was not until December 2020 that effective vaccines were discovered. By now, COVID-19 has more than 635 million cases and more than 6 million deaths. Counties seal borders; people wear masks; school and works go virtually. As the epidemic continued, the economy started to recess: companies became bankrupted, and people struggled with continued unemployment. Though countries respond to the pandemic differently, most countries commit huge losses. The global economy suffers during and after the pandemic. 

The pandemic dramatically changes daily life and global dynamics. We are curious about the global and local impact of COVID-19. What is the worldwide impact of COVID-19? How do the regional impacts of COVID-19 differ from region to region? What are the potential reasons for the difference? We focus on the impact of COVID-19 in China. China has a large discrepancy in economic development across regions (East, Middle, West). The eastern region includes cities such as Shanghai, Hangzhou, Shandong and etc. They are relatively closer to the ports on the east coast, and trade makes a huge contribution to the economy. However, central and western regions of China relies heavily on natural resources, such as coal, copper, rare earths, and animal husbandry. In addition, the eastern region of China is mostly plain, livable, and has a large population, and keep attracting a large number of outstanding elites every year, while the western region is mostly plateau, sparsely populated, and the lack of talents also leads to low-tech industries and low labor costs. Also, their infrastructure and medical resource in Middle and West region is lagging behind. We are curious about whether the COVID's impact to China's economics is different across regions, and we will probe the interactions between regions of China during the pandemic. We will only use provinces in mainland China (excludes Taiwan, Hongkong, Macao) for policy consistency, and our research target is mainly focus on economic aspect.

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Proposal

## Research topic

Recent years have witnessed the significant impact of COVID-19. Discovered in December 2019, COVID-19 quickly spread throughout the world. In March 2020, The World Health Organization declared the COVID-19 outbreak as a pandemic. It was not until December 2020 that effective vaccines were discovered. By now, COVID-19 has more than 635 million cases and more than 6 million deaths. Counties seal borders; people wear masks; school and works go virtually. As the epidemic continued, the economy started to recess: companies became bankrupted, and people struggled with continued unemployment. Though countries respond to the pandemic differently, most countries commit huge losses. The global economy suffers during and after the pandemic. 

The pandemic dramatically changes daily life and global dynamics. We are curious about the global and local impact of COVID-19. What is the worldwide impact of COVID-19? How do the regional impacts of COVID-19 differ from region to region? What are the potential reasons for the difference? We focus on the impact of COVID-19 in China. China has a large discrepancy in economic development across regions (East, Middle, West). The eastern region includes cities such as Shanghai, Hangzhou, Shandong and etc. They are relatively closer to the ports on the east coast, and trade makes a huge contribution to the economy. However, central and western regions of China relies heavily on natural resources, such as coal, copper, rare earths, and animal husbandry. In addition, the eastern region of China is mostly plain, livable, and has a large population, and keep attracting a large number of outstanding elites every year, while the western region is mostly plateau, sparsely populated, and the lack of talents also leads to low-tech industries and low labor costs. Also, their infrastructure and medical resource in Middle and West region is lagging behind. We are curious about whether the COVID's impact to China's economics is different across regions, and we will probe the interactions between regions of China during the pandemic. We will only use provinces in mainland China (excludes Taiwan, Hongkong, Macao) for policy consistency, and our research target is mainly focus on economic aspect.

Firstly, we use global GDP and US Dollar Index to gain an overall view of global economy from 2018 to 2021. Then we narrow down to COVID-19 impact on Chinese economy. Provincial GDP of East/Central/West China can reveal the impact of COVID-19 on regions which have different levels of economic development. Transportation cost data are used to explore the impact on transportation within and between provinces. Total import and export data can reveal the impact on international trade. Wholesale and retail trade data are used to measure offline transaction activity. At last, we visualize unemployment rate as a lagging indicator to measures the effect of economic events.

We apply techniques including faceting, Cleveland dot plot, scatter plot, Mosaic plot, spatial data visualization, etc. to explore the impact of COVID-19 on Chinese and global economy.

Reference: https://en.wikipedia.org/wiki/Timeline_of_the_COVID-19_pandemic

## Data availability

For the Covid-19 data, we download data from Harvard Dataverse (https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/MR5IJN). It contains 15 files including China Basemap,cityConfirmed, cityDeath,  cityRecover and all those time-series data are at provincial level. It would be a good dataset for us to analyze China's pandemic trend and severity stages across time. We also compared this data set with data from Google Covid-19 open data (https://health.google.com/covid-19/open-data/raw-data) and World Health Organization (https://covid19.who.int/data). We prefer dataset from Harvard because it includes provincial data, but we will still use WHO's data for a brief overlook at the global level.

For the provincial time-series economics data in China, we download data from China National Bureau of Statistics (https://data.stats.gov.cn/easyquery.htm?cn=G0104), which includes provincial GDP, Transportation Increment, Retailing Increment, Registered unemployment, Provincial Export, Provincial Import and etc. CNBS is the dataset built by the government and is considered as the most authoritative data for China, and we will use this dataset to measure economics overlook, supply-chain cost, offline store's operation, unemployment and China's trading account. We downloaded the USD index from Investing.com. The data from Investing is consistent with data from Bloomberg, but it's free for students outside Business School. For analysis of COVID-19's impact to USD index, we use time series data that range from 2018.10.31 to 2022.10.31. We choose this data because USD index is a good measure of investor's panic index from the Economist's perspective, for USD is considered as the safest asset in the world and investors tend to buy USD when the probability of recession increases.

All of our data are in csv or excel format. The data downloaded from CNBS is in a good stage, with no missing values and is in panel data format. The data from CNBS is collected by Chinese government from all provinces (autonomous regions and municipalities), cities (prefectures, prefectures, leagues) and some counties (cities, districts and flags). The database is built through investigation teams formed by Chinese government and is considered to be precise. On the other hand, China's COVID-19 data downloaded from Harvard Dataverse is sparse and has some missing values. Harvard Dataverse is updated to January 14, 2021. it was daily updated on the numbers of COVID-2019 confirmed, recovered, dead, foreign imported cases with Chinese provincial and city level base maps in the format of Shapefile. This dataset starts from January 15, 2020.

In future, if the data have problem, we can contact the owner of dataset through the "Contact" button provided by Harvard Dataverse's website. The good thing is, lots of scholars are using this database for research right now, and their citation and dataset's related publication is tractable. We can also contact them if we need further academic discussion.

<!--chapter:end:proposal.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data 

## Sources
For the global GDP by country data, we download the data from the World Bank (https://data.worldbank.org/indicator/NY.GDP.MKTP.CD?most_recent_value_desc=true). The World Bank is part of the United Nations system. The World Bank provides financial service for governments and most of the countries are its membership.So, the website of World Bank is a confidential information source. The website provides a link to download the GDP data as excel. The file contains GDP for over 200 countries and economies from 1980 to 2021. The GDP data is numeric. The country names and codes are characters. There are some missing values for GDP of some countries. But we are not going to use GDP for all countries. So, this problem causes no harm to our project. 

For the Covid-19 data, we download data from Harvard Dataverse (https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/MR5IJN). For the provincial time-series economics data in China, we download data from China National Bureau of Statistics (https://data.stats.gov.cn/easyquery.htm?cn=G0104), which includes provincial GDP, Transportation Increment, Retailing Increment, Registered unemployment, Provincial Export, Provincial Import and etc. For stock price data and US index data, we downloaded from Investing.com. The data from Investing is consistent with data from Bloomberg, therefore its credibility is validated.

Reference: https://en.wikipedia.org/wiki/World_Bank

## Cleaning / transformation
For the global GDP by country data, we pre-processed it in the excel file. We deleted other columns and only left columns: Country, 2018 GDP, 2019 GDP, 2020 GDP, and 2021 GDP. Then, we sorted based on 2021 GDP descendingly. The file included GDP for economies, such as European Union and IBRD. We manually filtered and left the top 5 countries with the largest GDP. We exported the processed excel file into rmd file. 
For the processing of China's economic data, we use differences in growth rates to better illustrate the impact of the pandemic, because most provinces' GDP still grew during the pandemic, but at a slower rate.

## Missing value analysis

There is no missing value in china_economics.xlsx. We can verify this by drawing the below graph to show the location of missing value:
```{r}
# install.packages("remotes")
# remotes::install_github("jtr13/redav")
library(redav)
# Take gdp for example
plot_missing(gdp, percent = FALSE)
# plot_missing(transport, percent = FALSE)
# plot_missing(retail, percent = FALSE)
# plot_missing(unemployment, percent = FALSE)
# plot_missing(import, percent = FALSE)
# plot_missing(export, percent = FALSE)
```

There is missing volume in US dollar historical index, but we only used column date and price.

```{r}
df2 <- read.csv(file="US Dollar Index Historical Data.csv")
plot_missing(df2, percent=FALSE)
```

<!--chapter:end:data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

```{r, setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```
```{r}
library(ggplot2)
library(GGally)
library(redav)
library(tidyr)
library("readxl")
#install.packages("remotes")
#remotes::install_github("jtr13/redav")
```

## Global Economy Impact
```{r, results='hide'}
df1 <- read_excel("GDP_Global.xlsx")
df1 
```

```{r, results='hide'}
df1_1 <- df1[-c(3)]
df1_1$'2019' <- 100* (df1$'2019'-df1$'2018')/df1$'2018'
df1_1$'2020' <- 100* (df1$'2020'-df1$'2019')/df1$'2019'
df1_1$'2021' <- 100* (df1$'2021'-df1$'2020')/df1$'2020'

df1_1
```

```{r}
ggparcoord(df1_1, columns=3:5, groupColumn=1, scale="globalminmax", title="GDP Growth Rates by Country") +
  xlab("Year")+
  ylab("GDP Growth Precentage")+
  theme_bw()+
  scale_color_discrete(breaks=c("United States", "China", "Japan", "United Kingdom", "Germany"))
```

The graph shows the GDP growth rates for the top five countries with the highest GDP. The GDP of these countries accounts for more than half of the world GDP. They well indicate the global economy. We can observe from the graph that most of the countries, expect China, experienced negative GDP growth in 2020. Most of the countries, expect China and Germany, experienced the lowest GDP growth in 2020. The global economy was not going well during the pandemic. 


```{r, results='hide'}
df2 <- read.csv(file="US Dollar Index Historical Data.csv")
head(df2)
```
There is no missing value for columns used in this project: Date and Price.

```{r, results='hide'}
df2$Date <- as.Date(df2$Date, format = "%m/%d/%Y")
head(df2)
```

```{r}
ggplot(data=df2, aes(Date, Price))+
  geom_line()+
  ggtitle("US Dollar Index")+
  geom_vline(xintercept = as.Date("03/11/2020", format = "%m/%d/%Y"), color="blue", alpha=0.3)+
  annotate("text", x=as.Date("03/11/2020", format = "%m/%d/%Y"), y=112, color="blue", label="The World Health Organization declared \n the COVID-19 outbreak a pandemic \n 2020/03/11", hjust=0)+
  theme_bw()
```

The US dollar index tracks the relative value of the U.S. dollar against a basket of important world currencies: Euro, Japanese yen, Pound sterling, Canadian dollar, Swedish krona, and Swiss franc. The six currencies included in the USDX are often referred to as America's most significant trading partners. So, the index implies the strength of US dollar. US Dollar is considered as the safest asset in the world and investors tend to buy it when the probability of economic recession increases. When more people invest in USD, it is stronger. The US dollar index is a good measure of investorâ€™s panic and global economy. 

We can obverse from the graph that the US dollar index increases dramatically around March 11, 2020, when the World Health Organization declared the COVID-19 outbreak a pandemic. The pandemic lowered investor's confidence in global economy and motivated more investment in safer asset, such as USD. This trend corresponds to what we observed in the previous graph: the global GDP growth dropped significantly during the pandemic. 

Reference: https://www.investopedia.com/terms/u/usdx.asp


## Chinese Economy Impact

The COVID-19 pandemic will have an impact on different provinces and industries in China. During the outbreak in 2020, transportation, retail, urban registered unemployment rate, total import, total export, net export and other industries all showed a slow growth trend. This pattern of decline is concentrated in the Midwest. As we know, the development of eastern China mainly depends on its technology and services, while the development of central and western China, such as Shanxi, Xinjiang and Inner Mongolia, takes advantage of its abundant resources (coal, metals, cotton). Companies in these areas produce primary products and transfer them to eastern China or abroad for further processing.

To better illustrate the downward trend, we use the percentage change in growth rates between 2020 and 2019 to measure the decline. To ensure that the worse the indicator, the darker the map, we use the negative sign of the original value to draw the graph. 

```{r}
library(readxl)
gdp <- read_excel("china_economics.xlsx", sheet = 1)
transport <- read_excel("china_economics.xlsx", sheet = 2)
retail <- read_excel("china_economics.xlsx", sheet = 3)
unemployment <- read_excel("china_economics.xlsx", sheet = 4)
import <- read_excel("china_economics.xlsx", sheet = 5)
export <- read_excel("china_economics.xlsx", sheet = 6)
delta_gdp <- (gdp$`2020`-gdp$`2019`)/gdp$`2019` - (gdp$`2019`-gdp$`2018`)/gdp$`2018`
delta_transport <- (transport$`2020`-transport$`2019`)/transport$`2019` - (transport$`2019`-transport$`2018`)/transport$`2018`
delta_retail <- (retail$`2020`-retail$`2019`)/retail$`2019` - (retail$`2019`-retail$`2018`)/retail$`2018`
delta_unemployment <- (unemployment$`2020`-unemployment$`2019`)/unemployment$`2019` - (unemployment$`2019`-unemployment$`2018`)/unemployment$`2018`
delta_import <- (import$`2020`-import$`2019`)/import$`2019` - (import$`2019`-import$`2018`)/import$`2018`
delta_export <- (export$`2020`-export$`2019`)/export$`2019` - (export$`2019`-export$`2018`)/export$`2018`
delta_net_export <- ((export$`2020`-import$`2020`)-(export$`2019`-import$`2019`))/(export$`2019`-import$`2019`) - ((export$`2019`-import$`2019`)-(export$`2018`-import$`2018`))/(export$`2018`-import$`2018`)
```

As we can see from the chart below, the GDP growth rate of most provinces in China declined from 2019 to 2020, especially the central provinces. Hubei, the province where the epidemic first broke out, saw the biggest drop. The situation is similar in the neighboring provinces of Hubei.

As can be seen from figures 2 and 3, western and central China suffered the greatest losses in terms of transportation and retail sales. Especially Hubei and Xinjiang. Xinjiang has a famous port called "Horgos", the largest railway port in Xinjiang Uygur Autonomous Region, which mainly supports the development of Xinjiang's textile and clothing industry, as well as foreign trade and service industry. Lockdown policies in western provinces tend to be stricter in the west, which will have a negative impact on traffic and retail revenue in western provinces.

We analyze unemployment in the fourth chart. From 2019 to 2020, the rate of unemployment growth in most provinces was positive. We can only see declines in a few western and central provinces.

In figures 5, 6 and 7, we focus on the transaction records of Chinese provinces. Provinces close to the border have seen a drop in imports and exports. Between 2019 and 2020, the growth rate of net exports in Tibet and Yunnan fell sharply. The impact on the eastern region is slighter than the Midwest. As noted above, the western provinces tended to have more restrictive lockdown policies, and their economies were more dependent on trade in resources and raw materials. We believe this is a contributing factor to the above results.

```{r}
# install.packages('hchinamap', build_vignettes = TRUE)
library(dplyr)
library(magrittr)
library(hchinamap)
dir <- tempdir()
download.file('https://czxb.github.io/br/chinadf.rda', file.path(dir, 'chinadf.rda'))
load(file.path(dir, 'chinadf.rda'), verbose = TRUE);
china <- chinadf %>% dplyr::filter(region == "China")
hchinamap(name = china$name[1:length(delta_gdp)], value = -delta_gdp,
           width = "100%", height = "400px",
           title = "Change of GDP Growth Rate - China", region = "China")
hchinamap(name = china$name[1:length(delta_transport)], value = -delta_transport,
           width = "100%", height = "400px",
           title = "Change of Transport Growth Rate - China", region = "China")
hchinamap(name = china$name[1:length(delta_retail)], value = -delta_retail,
           width = "100%", height = "400px",
           title = "Change of Retail Growth Rate - China", region = "China")
hchinamap(name = china$name[1:length(delta_unemployment)], value = -delta_unemployment,
           width = "100%", height = "400px",
           title = "Change of Unemployment Growth Rate - China", region = "China")
hchinamap(name = china$name[1:length(delta_import)], value = -delta_import,
           width = "100%", height = "400px",
           title = "Change of Import Growth Rate - China", region = "China")
hchinamap(name = china$name[1:length(delta_export)], value = -delta_export,
           width = "100%", height = "400px",
           title = "Change of Export Growth Rate - China", region = "China")
hchinamap(name = china$name[1:length(delta_net_export)], value = -delta_net_export,
           width = "100%", height = "400px",
           title = "Change of Net Export Growth Rate - China", region = "China")
```

<!--chapter:end:results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component

<meta charset="utf-8">
<title>NYUJobs></title>
<style type="text/css">
   h1 {color:black;}  /* CSS styling */
   p {color:blue;}
</style>
<body>
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v7.js"></script>
<h1>Job salary/numbers according to category</h1>
 </h3>
<!-- Add buttons -->
<button onclick="update(data1)">2018 GDP (*1000000)</button>
<button onclick="update(data2)">2019 GDP (*1000000)</button>
<button onclick="update(data3)">2020 GDP (*1000000)</button>
<button onclick="update(data4)">2021 GDP (*1000000)</button>


<!-- Create a div where the graph will take place -->
<div id="d3try" ></div>
<script>
// create  data_set
var data1 = [ 
   {Category: "USA", value: 20527156.0},
   {Category: "CHN", value: 13894817.5},
   {Category: "JPN", value: 5037835.4},
   {Category: "DEU", value: 3977289.5},
   {Category: "GBR", value: 2900791.4},
];

var data2 = [
   {Category: "USA", value: 21372572.4},
   {Category: "CHN", value: 14279937.5},
   {Category: "JPN", value: 5123318.2},
   {Category: "DEU", value: 3888326.8},
   {Category: "GBR", value: 2878673.9},
];

var data3 = [
   {Category: "USA", value: 20893743.8},
   {Category: "CHN", value: 14687673.9},
   {Category: "JPN", value: 5040107.8},
   {Category: "DEU", value: 3846413.9},
   {Category: "GBR", value: 2756900.2},
   ];

var data4 = [
   {Category: "USA", value: 22996100},
   {Category: "CHN", value: 17734062.6},
   {Category: "JPN", value: 4937421.8},
   {Category: "DEU", value: 4223116.2},
   {Category: "GBR", value: 3186859.7},
   ];



// set the dimensions and margins of the graph
var margin = {top: 30, right: 10, bottom: 70, left: 60},
    width = 800 - margin.left - margin.right,
    height = 450 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#d3try")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")")
   .append("g", id ='circ');
  
// Initialize the X axis
var x = d3.scaleBand()
  .range([ 0, width ])
  .padding(0.2);
var xAxis = svg.append("g")
  .attr("transform", "translate(0," + height + ")")

// Initialize the Y axis
var y = d3.scaleLinear()
  .range([ height, 0]);
var yAxis = svg.append("g")
  .attr("class", "myYaxis")

// A function that create / update the plot for a given variable:
function update(data) {

  // Update the X axis
  x.domain(data.map(function(d) { return d.Category; }))
  xAxis.call(d3.axisBottom(x))

  // Update the Y axis
  y.domain([0, d3.max(data, function(d) { return d.value }) ]);
  yAxis.transition().duration(1000).call(d3.axisLeft(y));

  // Create the u variable
  var u = svg.selectAll("rect")
    .data(data)

  u
    .enter()
    .append("rect") // Add a new rect for each new elements
    .merge(u) // get the already existing elements as well
    .transition() // and apply changes to all of them
    .duration(1000)
      .attr("x", function(d) { return x(d.Category); })
      .attr("y", function(d) { return y(d.value); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.value); })
      .attr("fill", "#7b6888")

var rect=svg.selectAll("rect").on("mouseover", function() {
               //highlight
                 d3.select(this).style("fill","#BA5C25");
                })
            .on("mouseout", function(d) {
                 d3.select(this).style("fill","#7b6888");
                });

  // If less group in the new dataset, I delete the ones not in use anymore
  u
    .exit()
    .remove()
    
      
    
}
update(data1)





</script>
</body>

<!--chapter:end:interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion

## Main Takeaways

In this project, we fathom the economy impact of COVID-19. From a global scale, the economy recessed during the pandemic, namely in the year of 2020. When the World Health Organization declared the COVID-19 outbreak a pandemic, investors sense the possibility of economy recession and invested more low-risk assets. 

COVID-19 first outbroke in Wuhan, Hubei province, and spread to its neighbor provinces. We focused on the different economy impacts on different provinces in China. The pandemic had negative impacts to the national GDP: most provinces experienced negative GDP growth rate in the year of 2020, which was rare in history. The Midwest provinces had more sever economy drawback during the pandemic. Hubei, where COVID-19 first outbroke, had the most sever economy recession. The difference may be caused by the different locations, industrial structures, and lockdown policies. The western provinces tended to have more restrictive lockdown policies, and their economies were more dependent on trade in resources and raw materials. Western and central China suffered the greatest losses in terms of transportation and retail sales, especially Hubei and Xinjiang. Provinces close to the border have seen a drop in imports and exports, especially Tibet and Yunnan. From 2019 to 2020, the rate of unemployment growth in most provinces was positive. We can only see declines in a few western and central provinces.

## Limitation and Future Directions

The analysis in this project in primarily exploratory. For further research, we could inspect more on the reasons of differences in economy performances across provinces. For example, we could research more closely on the factors affecting province overall economy performance. We could show the weight of each sector in the GDP for each province and quantify the level of restrictiveness of lockdown policy for each province. We could build machine learning models on these factors and analysis the constitution of GDP performance quantitatively.  

## Lessons Learned

<!--chapter:end:conclusion.Rmd-->

